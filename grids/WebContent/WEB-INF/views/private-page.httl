<!DOCTYPE html>
<html>
#set(components = ["bootstrap", "layout", "stream", "tag", "usercard"])
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>贤者：用户页</title>
	$!{includeCSS()}
</head>
<body>
$!{include("navbar.httl")}
<div id="data-holder">
    <span id="user-self-json">${userSelfJson}</span>
    <span id="tag-tree-json">${tagTreeJson}</span>
    <span id="id-holder">${id}</span>
    #if(isSelfPage != null)
    <span id="is-self-page"></span>
    #end
</div>

<div class="container" id="container" style="margin-top: 50px">
	<div class="row">
		<div class="side span3"></div>
		<div class="main span9">
			<div class="stream row">
				<div class="slist span9"></div>
			</div>
		</div>
	</div>
	<div class="footer"></div>
</div>
$!{include("proto.httl")}
$!{includeJS()}
<script type="text/javascript">
$(document).ready(function(){
    var $selfCard = createUserCard(userSelf).css('border', '').css('border-radius', '');
    $selfCard.find('.follow').remove();
    $selfCard.appendTo($('.side'));
    
	var deferred = getStream('/sage/read/u/' + $('#id-holder').text());
	if ($('#is-self-page').length > 0) {
	    deferred.done(function(){
		    $('.slist .tweet').warnEmpty().each(function(){
		        var $tweet = $(this);
		        var $del = $('<a href="javascript:;">').text('删除')
		        .css({marginLeft: '0.5em', marginRight: '0.5em'})
		        .click(function(){
		            event.preventDefault();
		            var id = $tweet.data('id');
		            if (!id) {
		                console.warn('this id is '+id);
		                return;
		            }
		            $.post(webroot+'/tweet/'+id+'/delete');
		        });
		        console.log($tweet.data('id'));
		        $(this).find('.forward').before($del);
		    });
	    });
	}
});
</script>
</body>
</html>